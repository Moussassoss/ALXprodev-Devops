#!/bin/bash
# batchProcessing-0x02
# Script to fetch data for multiple Pokémon and store each in its own file

API_BASE_URL="https://pokeapi.co/api/v2/pokemon"
POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
OUTPUT_DIR="pokemon_data"

# Create output directory if it doesn't exist
mkdir -p "$OUTPUT_DIR"

for pokemon in "${POKEMONS[@]}"; do
    echo "Fetching data for $pokemon..."
    OUTPUT_FILE="${OUTPUT_DIR}/${pokemon}.json"

    # Make the API request quietly (-s), and store only if successful (HTTP 200)
    status_code=$(curl -s -w "%{http_code}" -o "$OUTPUT_FILE" "$API_BASE_URL/$pokemon")

    if [ "$status_code" -eq 200 ]; then
        echo "Saved data to ${OUTPUT_FILE} ✅"
    else
        echo "❌ Failed to fetch data for ${pokemon} (HTTP $status_code)"
        rm -f "$OUTPUT_FILE"  # remove incomplete file
    fi

    # Add delay to handle rate-limiting
    sleep 2
done
